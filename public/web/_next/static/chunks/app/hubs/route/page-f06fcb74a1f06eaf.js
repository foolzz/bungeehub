(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[989],{1150:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return o}});let s=a(5155),r=a(2115),l=a(4437);function n(e){return{default:e&&"default"in e?e.default:e}}a(6552);let i={loader:()=>Promise.resolve(n(()=>null)),loading:null,ssr:!0},o=function(e){let t={...i,...e},a=(0,r.lazy)(()=>t.loader().then(n)),o=t.loading;function d(e){let n=o?(0,s.jsx)(o,{isLoading:!0,pastDelay:!0,error:null}):null,i=!t.ssr||!!t.loading,d=i?r.Suspense:r.Fragment,c=t.ssr?(0,s.jsxs)(s.Fragment,{children:[null,(0,s.jsx)(a,{...e})]}):(0,s.jsx)(l.BailoutToCSR,{reason:"next/dynamic",children:(0,s.jsx)(a,{...e})});return(0,s.jsx)(d,{...i?{fallback:n}:{},children:c})}return d.displayName="LoadableComponent",d}},1753:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>h});var s=a(5155),r=a(2115),l=a(7909),n=a(7621);let i=(0,l.default)(()=>Promise.all([a.e(761),a.e(538)]).then(a.bind(a,3538)).then(e=>e.MapContainer),{loadableGenerated:{webpack:()=>[3538]},ssr:!1}),o=(0,l.default)(()=>Promise.all([a.e(761),a.e(538)]).then(a.bind(a,3538)).then(e=>e.TileLayer),{loadableGenerated:{webpack:()=>[3538]},ssr:!1}),d=(0,l.default)(()=>Promise.all([a.e(761),a.e(538)]).then(a.bind(a,3538)).then(e=>e.Marker),{loadableGenerated:{webpack:()=>[3538]},ssr:!1}),c=(0,l.default)(()=>Promise.all([a.e(761),a.e(538)]).then(a.bind(a,3538)).then(e=>e.Popup),{loadableGenerated:{webpack:()=>[3538]},ssr:!1}),u=(0,l.default)(()=>Promise.all([a.e(761),a.e(538)]).then(a.bind(a,3538)).then(e=>e.Polyline),{loadableGenerated:{webpack:()=>[3538]},ssr:!1});function h(){let[e,t]=(0,r.useState)(null),[l,h]=(0,r.useState)([]),[p,m]=(0,r.useState)([]),[x,g]=(0,r.useState)(!0),[b,f]=(0,r.useState)(""),[y,v]=(0,r.useState)(""),[j,N]=(0,r.useState)(null),[w,k]=(0,r.useState)(0);(0,r.useEffect)(()=>{{let e=document.createElement("link");e.rel="stylesheet",e.href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css",document.head.appendChild(e)}a.e(761).then(a.t.bind(a,5027,23)).then(e=>{N(e),delete e.Icon.Default.prototype._getIconUrl,e.Icon.Default.mergeOptions({iconRetinaUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png",iconUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png",shadowUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png"})})},[]),(0,r.useEffect)(()=>{(async()=>{let e=new URLSearchParams(window.location.search).get("id");if(!e){f("No hub ID provided"),g(!1);return}v(e),await P(e)})()},[]);let P=async e=>{var a,s;try{g(!0);let s=(await n.ZQ.getProfile()).data,r=(await n.bI.getById(e)).data;if(s.id!==r.hostId&&"ADMIN"!==s.role){f("You do not have permission to view routes for this hub"),g(!1);return}t(r);let l=((null==(a=(await n.ox.getAll({assignedHubId:e,status:"OUT_FOR_DELIVERY",limit:100})).data)?void 0:a.data)||[]).filter(e=>e.deliveryLatitude&&e.deliveryLongitude);if(h(l),l.length>0&&r.latitude&&r.longitude){let e=function(e,t){if(0===t.length)return[];let a=[...t],s=[],r=parseFloat(e.latitude),l=parseFloat(e.longitude);for(;a.length>0;){let e=0,t=1/0;a.forEach((a,s)=>{let n=parseFloat(a.deliveryLatitude),i=parseFloat(a.deliveryLongitude),o=function(e,t,a,s){let r=(a-e)*Math.PI/180,l=(s-t)*Math.PI/180,n=Math.sin(r/2)*Math.sin(r/2)+Math.cos(e*Math.PI/180)*Math.cos(a*Math.PI/180)*Math.sin(l/2)*Math.sin(l/2);return 2*Math.atan2(Math.sqrt(n),Math.sqrt(1-n))*6371}(r,l,n,i);o<t&&(t=o,e=s)});let n=a.splice(e,1)[0];s.push({...n,distance:t}),r=parseFloat(n.deliveryLatitude),l=parseFloat(n.deliveryLongitude)}return s}(r,l);m(e);let t=e.reduce((e,t)=>e+(t.distance||0),0);k(t)}}catch(e){console.error("Error:",e),(null==(s=e.response)?void 0:s.status)===401?window.location.href="/login":f("Failed to load route data")}finally{g(!1)}};if(x)return(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsx)("div",{className:"text-xl",children:"Optimizing route..."})});if(b)return(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-xl text-red-600 mb-4",children:b}),(0,s.jsx)("a",{href:"/dashboard",className:"bg-primary-600 text-white px-4 py-2 rounded-md hover:bg-primary-700",children:"Back to Dashboard"})]})});if(!e||!j)return(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsx)("div",{className:"text-xl",children:"Loading..."})});if(0===p.length)return(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,s.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"text-center bg-white shadow rounded-lg p-8",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"No Deliveries to Optimize"}),(0,s.jsx)("p",{className:"text-gray-600 mb-6",children:'There are no packages marked as "OUT FOR DELIVERY" for this hub.'}),(0,s.jsx)("a",{href:"/hubs/details?id=".concat(y),className:"bg-primary-600 text-white px-4 py-2 rounded-md hover:bg-primary-700",children:"Back to Hub Details"})]})})});let _=parseFloat(e.latitude),O=parseFloat(e.longitude),S=[[_,O],...p.map(e=>[parseFloat(e.deliveryLatitude),parseFloat(e.deliveryLongitude)])];return(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,s.jsxs)("div",{className:"mb-6 flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Optimized Delivery Route"}),(0,s.jsx)("p",{className:"text-gray-600 mt-1",children:e.name})]}),(0,s.jsx)("a",{href:"/hubs/details?id=".concat(y),className:"bg-gray-200 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-300",children:"Back to Hub"})]}),(0,s.jsxs)("div",{className:"grid md:grid-cols-3 gap-6 mb-6",children:[(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-2 text-gray-700",children:"Total Stops"}),(0,s.jsx)("p",{className:"text-3xl font-bold text-primary-600",children:p.length})]}),(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-2 text-gray-700",children:"Total Distance"}),(0,s.jsxs)("p",{className:"text-3xl font-bold text-blue-600",children:[w.toFixed(2)," km"]})]}),(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-2 text-gray-700",children:"Avg Distance/Stop"}),(0,s.jsxs)("p",{className:"text-3xl font-bold text-green-600",children:[(w/p.length).toFixed(2)," km"]})]})]}),(0,s.jsxs)("div",{className:"grid lg:grid-cols-2 gap-6",children:[(0,s.jsx)("div",{className:"bg-white shadow rounded-lg overflow-hidden",style:{height:"600px"},children:(0,s.jsxs)(i,{center:[_,O],zoom:13,style:{height:"100%",width:"100%"},children:[(0,s.jsx)(o,{attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),(0,s.jsx)(d,{position:[_,O],children:(0,s.jsx)(c,{children:(0,s.jsxs)("div",{className:"p-2",children:[(0,s.jsxs)("h3",{className:"font-bold",children:["START: ",e.name]}),(0,s.jsx)("p",{className:"text-xs",children:e.address})]})})}),(0,s.jsx)(u,{positions:S,color:"blue",weight:3}),p.map((e,t)=>{var a;let r=parseFloat(e.deliveryLatitude),l=parseFloat(e.deliveryLongitude),n=j.divIcon({html:'<div style="background-color: #3b82f6; color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3);">'.concat(t+1,"</div>"),className:"",iconSize:[30,30],iconAnchor:[15,15]});return(0,s.jsx)(d,{position:[r,l],icon:n,children:(0,s.jsx)(c,{children:(0,s.jsxs)("div",{className:"p-2",children:[(0,s.jsxs)("h3",{className:"font-bold",children:["Stop #",t+1]}),(0,s.jsx)("p",{className:"text-sm",children:e.trackingNumber}),(0,s.jsx)("p",{className:"text-sm",children:e.recipientName}),(0,s.jsx)("p",{className:"text-xs text-gray-600",children:e.deliveryAddress}),(0,s.jsxs)("p",{className:"text-xs text-blue-600 mt-1",children:[null==(a=e.distance)?void 0:a.toFixed(2)," km from previous"]})]})})},e.id)})]})}),(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:[(0,s.jsx)("div",{className:"px-6 py-4 border-b",children:(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Delivery Sequence"})}),(0,s.jsx)("div",{className:"overflow-y-auto",style:{maxHeight:"536px"},children:p.map((e,t)=>{var a;return(0,s.jsx)("div",{className:"px-6 py-4 border-b hover:bg-gray-50 transition",children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)("div",{className:"bg-blue-600 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0",children:t+1}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("div",{className:"font-medium text-gray-900",children:e.recipientName}),(0,s.jsx)("div",{className:"text-sm text-gray-600 truncate",children:e.deliveryAddress}),(0,s.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:e.trackingNumber}),e.specialInstructions&&(0,s.jsxs)("div",{className:"text-xs text-blue-600 mt-1",children:["\uD83D\uDCDD ",e.specialInstructions]}),(0,s.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:[null==(a=e.distance)?void 0:a.toFixed(2)," km from previous stop"]})]})]})},e.id)})})]})]}),(0,s.jsx)("div",{className:"mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,s.jsxs)("p",{className:"text-blue-800 text-sm",children:[(0,s.jsx)("strong",{children:"Route Optimization:"})," This route is optimized using the nearest-neighbor algorithm. Starting from your hub, each delivery stop is chosen as the nearest unvisited package location. This provides a good balance between route efficiency and computational speed."]})})]})})}},4054:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{bindSnapshot:function(){return n},createAsyncLocalStorage:function(){return l},createSnapshot:function(){return i}});let a=Object.defineProperty(Error("Invariant: AsyncLocalStorage accessed in runtime where it is not available"),"__NEXT_ERROR_CODE",{value:"E504",enumerable:!1,configurable:!0});class s{disable(){throw a}getStore(){}run(){throw a}exit(){throw a}enterWith(){throw a}static bind(e){return e}}let r="undefined"!=typeof globalThis&&globalThis.AsyncLocalStorage;function l(){return r?new r:new s}function n(e){return r?r.bind(e):s.bind(e)}function i(){return r?r.snapshot():function(e,...t){return e(...t)}}},4437:(e,t,a)=>{"use strict";function s(e){let{reason:t,children:a}=e;return a}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return s}}),a(4553)},6278:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r}});let s=a(8140)._(a(1150));function r(e,t){var a;let r={};"function"==typeof e&&(r.loader=e);let l={...r,...t};return(0,s.default)({...l,modules:null==(a=l.loadableGenerated)?void 0:a.modules})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},6552:(e,t,a)=>{"use strict";function s(e){let{moduleIds:t}=e;return null}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadChunks",{enumerable:!0,get:function(){return s}}),a(5155),a(7650),a(8567),a(7278)},7185:(e,t,a)=>{Promise.resolve().then(a.bind(a,1753))},7621:(e,t,a)=>{"use strict";a.d(t,{ZQ:()=>n,bI:()=>i,ic:()=>d,ox:()=>o});var s=a(5125);let r=a(5704).env.NEXT_PUBLIC_API_URL||"http://localhost:8080/api/v1",l=s.A.create({baseURL:r,headers:{"Content-Type":"application/json"}});l.interceptors.request.use(e=>{let t=localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e});let n={login:(e,t)=>l.post("/auth/login",{email:e,password:t}),register:e=>l.post("/auth/register",e),getProfile:()=>l.get("/auth/profile")},i={getAll:()=>l.get("/hubs"),getMyHubs:()=>l.get("/hubs/my-hubs"),getById:e=>l.get("/hubs/".concat(e)),getMetrics:(e,t)=>l.get("/hubs/".concat(e,"/metrics"),{params:{days:t}}),create:e=>l.post("/hubs",e),update:(e,t)=>l.put("/hubs/".concat(e),t)},o={getAll:e=>l.get("/packages",{params:e}),getById:e=>l.get("/packages/".concat(e)),track:e=>l.get("/packages/tracking/".concat(e)),create:e=>l.post("/packages",e),update:(e,t)=>l.put("/packages/".concat(e),t),delete:e=>l.delete("/packages/".concat(e))},d={getDashboard:()=>l.get("/admin/dashboard"),getPendingApplications:(e,t)=>l.get("/admin/applications/pending",{params:{page:e,limit:t}}),getApplicationDetails:e=>l.get("/admin/applications/".concat(e)),reviewApplication:(e,t)=>l.post("/admin/applications/".concat(e,"/review"),t)}},7828:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"workAsyncStorageInstance",{enumerable:!0,get:function(){return s}});let s=(0,a(4054).createAsyncLocalStorage)()},7909:(e,t,a)=>{"use strict";a.d(t,{default:()=>r.a});var s=a(6278),r=a.n(s)},8567:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"workAsyncStorage",{enumerable:!0,get:function(){return s.workAsyncStorageInstance}});let s=a(7828)}},e=>{e.O(0,[125,441,255,358],()=>e(e.s=7185)),_N_E=e.O()}]);