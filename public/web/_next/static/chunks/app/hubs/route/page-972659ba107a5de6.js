(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[989],{1150:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return o}});let s=a(5155),r=a(2115),i=a(4437);function l(e){return{default:e&&"default"in e?e.default:e}}a(6552);let n={loader:()=>Promise.resolve(l(()=>null)),loading:null,ssr:!0},o=function(e){let t={...n,...e},a=(0,r.lazy)(()=>t.loader().then(l)),o=t.loading;function d(e){let l=o?(0,s.jsx)(o,{isLoading:!0,pastDelay:!0,error:null}):null,n=!t.ssr||!!t.loading,d=n?r.Suspense:r.Fragment,c=t.ssr?(0,s.jsxs)(s.Fragment,{children:[null,(0,s.jsx)(a,{...e})]}):(0,s.jsx)(i.BailoutToCSR,{reason:"next/dynamic",children:(0,s.jsx)(a,{...e})});return(0,s.jsx)(d,{...n?{fallback:l}:{},children:c})}return d.displayName="LoadableComponent",d}},1753:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>m});var s=a(5155),r=a(2115),i=a(7909),l=a(7621);let n=(0,i.default)(()=>Promise.all([a.e(761),a.e(538)]).then(a.bind(a,3538)).then(e=>e.MapContainer),{loadableGenerated:{webpack:()=>[3538]},ssr:!1}),o=(0,i.default)(()=>Promise.all([a.e(761),a.e(538)]).then(a.bind(a,3538)).then(e=>e.TileLayer),{loadableGenerated:{webpack:()=>[3538]},ssr:!1}),d=(0,i.default)(()=>Promise.all([a.e(761),a.e(538)]).then(a.bind(a,3538)).then(e=>e.Marker),{loadableGenerated:{webpack:()=>[3538]},ssr:!1}),c=(0,i.default)(()=>Promise.all([a.e(761),a.e(538)]).then(a.bind(a,3538)).then(e=>e.Popup),{loadableGenerated:{webpack:()=>[3538]},ssr:!1}),u=(0,i.default)(()=>Promise.all([a.e(761),a.e(538)]).then(a.bind(a,3538)).then(e=>e.Polyline),{loadableGenerated:{webpack:()=>[3538]},ssr:!1});function h(e){let t=Math.floor(e/60),a=Math.floor(e%60);return t>0?"".concat(t,"h ").concat(a,"m"):"".concat(a,"m")}function m(){let[e,t]=(0,r.useState)(null),[i,m]=(0,r.useState)([]),[p,g]=(0,r.useState)([]),[x,f]=(0,r.useState)(!0),[b,v]=(0,r.useState)(""),[y,j]=(0,r.useState)(""),[w,N]=(0,r.useState)(null),[k,S]=(0,r.useState)(0),[_,P]=(0,r.useState)(0),[O,M]=(0,r.useState)(null),[D,T]=(0,r.useState)([]),[L,A]=(0,r.useState)(!1);(0,r.useEffect)(()=>{{let e=document.createElement("link");e.rel="stylesheet",e.href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css",document.head.appendChild(e)}a.e(761).then(a.t.bind(a,5027,23)).then(e=>{N(e),delete e.Icon.Default.prototype._getIconUrl,e.Icon.Default.mergeOptions({iconRetinaUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png",iconUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png",shadowUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png"})})},[]),(0,r.useEffect)(()=>{(async()=>{let e=new URLSearchParams(window.location.search).get("id");if(!e){v("No hub ID provided"),f(!1);return}j(e),await F(e)})()},[]);let I=async e=>{try{let t=e.map(e=>"".concat(e.lng,",").concat(e.lat)).join(";"),a=await fetch("https://router.project-osrm.org/route/v1/driving/".concat(t,"?overview=full&geometries=geojson&steps=true")),s=await a.json();if("Ok"===s.code&&s.routes&&s.routes.length>0){let e=s.routes[0];return{coordinates:e.geometry.coordinates.map(e=>[e[1],e[0]]),distance:e.distance/1e3,duration:e.duration/60,steps:e.legs||[]}}return null}catch(e){return console.error("Error fetching driving route:",e),null}},F=async e=>{var a,s;try{f(!0);let s=(await l.ZQ.getProfile()).data,r=(await l.bI.getById(e)).data;if(s.id!==r.hostId&&"ADMIN"!==s.role){v("You do not have permission to view routes for this hub"),f(!1);return}t(r);let i=((null==(a=(await l.ox.getAll({limit:1e3})).data)?void 0:a.data)||[]).filter(t=>{var a;return(null==(a=t.assignedHub)?void 0:a.id)===e&&("OUT_FOR_DELIVERY"===t.status||"AT_HUB"===t.status)&&t.deliveryLatitude&&t.deliveryLongitude});if(m(i),i.length>0&&r.latitude&&r.longitude){let e=function(e,t){if(0===t.length)return[];let a=[...t],s=[],r=parseFloat(e.latitude),i=parseFloat(e.longitude),l=0;for(;a.length>0;){let e=0,t=1/0;a.forEach((a,s)=>{let l=parseFloat(a.deliveryLatitude),n=parseFloat(a.deliveryLongitude),o=function(e,t,a,s){let r=(a-e)*Math.PI/180,i=(s-t)*Math.PI/180,l=Math.sin(r/2)*Math.sin(r/2)+Math.cos(e*Math.PI/180)*Math.cos(a*Math.PI/180)*Math.sin(i/2)*Math.sin(i/2);return 2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))*6371}(r,i,l,n);o<t&&(t=o,e=s)});let n=t/35*60;l+=n+4;let o=a.splice(e,1)[0];s.push({...o,distance:t,drivingTime:n,deliveryTime:4,cumulativeTime:l,estimatedArrival:new Date(Date.now()+60*l*1e3)}),r=parseFloat(o.deliveryLatitude),i=parseFloat(o.deliveryLongitude)}return s}(r,i);g(e);let t=e.reduce((e,t)=>e+(t.distance||0),0),a=e.length>0?e[e.length-1].cumulativeTime:0;S(t),P(a),M(e.length>0?e[e.length-1].estimatedArrival:null),A(!0);let s=[],l={lat:parseFloat(r.latitude),lng:parseFloat(r.longitude)};for(let t of e){let e={lat:parseFloat(t.deliveryLatitude),lng:parseFloat(t.deliveryLongitude)},a=await I([l,e]);a&&s.push({...a,packageId:t.id,from:l,to:e}),l=e}if(T(s),A(!1),s.length>0){let t=s.reduce((e,t)=>e+t.distance,0),a=s.reduce((e,t)=>e+t.duration,0),r=4*e.length;S(t),P(a+r),M(new Date(Date.now()+(a+r)*6e4));let i=e.map((e,t)=>{var a,r;return{...e,distance:(null==(a=s[t])?void 0:a.distance)||e.distance,drivingTime:(null==(r=s[t])?void 0:r.duration)||e.drivingTime,cumulativeTime:s.slice(0,t+1).reduce((e,t)=>e+t.duration,0)+(t+1)*4,estimatedArrival:new Date(Date.now()+(s.slice(0,t+1).reduce((e,t)=>e+t.duration,0)+(t+1)*4)*6e4)}});g(i)}}}catch(e){console.error("Error:",e),(null==(s=e.response)?void 0:s.status)===401?window.location.href="/login":v("Failed to load route data")}finally{f(!1)}};if(x)return(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsx)("div",{className:"text-xl",children:"Optimizing route..."})});if(b)return(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-xl text-red-600 mb-4",children:b}),(0,s.jsx)("a",{href:"/dashboard",className:"bg-primary-600 text-white px-4 py-2 rounded-md hover:bg-primary-700",children:"Back to Dashboard"})]})});if(!e||!w)return(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsx)("div",{className:"text-xl",children:"Loading..."})});if(0===p.length)return(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,s.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"text-center bg-white shadow rounded-lg p-8",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"No Deliveries to Optimize"}),(0,s.jsxs)("p",{className:"text-gray-600 mb-6",children:["There are currently no packages ready for delivery at this hub.",(0,s.jsx)("br",{}),'(Looking for packages with status "OUT_FOR_DELIVERY" or "AT_HUB")']}),(0,s.jsx)("a",{href:"/hubs/details?id=".concat(y),className:"bg-primary-600 text-white px-4 py-2 rounded-md hover:bg-primary-700",children:"Back to Hub Details"})]})})});let E=parseFloat(e.latitude),R=parseFloat(e.longitude),U=[[E,R],...p.map(e=>[parseFloat(e.deliveryLatitude),parseFloat(e.deliveryLongitude)])];return(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,s.jsxs)("div",{className:"mb-6 flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Optimized Delivery Route"}),(0,s.jsx)("p",{className:"text-gray-600 mt-1",children:e.name})]}),(0,s.jsx)("a",{href:"/hubs/details?id=".concat(y),className:"bg-gray-200 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-300",children:"Back to Hub"})]}),(0,s.jsxs)("div",{className:"grid md:grid-cols-4 gap-6 mb-6",children:[(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-2 text-gray-700",children:"Total Stops"}),(0,s.jsx)("p",{className:"text-3xl font-bold text-primary-600",children:p.length})]}),(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-2 text-gray-700",children:"Total Distance"}),(0,s.jsxs)("p",{className:"text-3xl font-bold text-blue-600",children:[k.toFixed(2)," km"]})]}),(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-2 text-gray-700",children:"Estimated Time"}),(0,s.jsx)("p",{className:"text-3xl font-bold text-green-600",children:h(_)}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Including delivery stops"})]}),(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-2 text-gray-700",children:"Est. Finish"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-purple-600",children:O?O.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"--:--"}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Starting now"})]})]}),(0,s.jsxs)("div",{className:"grid lg:grid-cols-2 gap-6",children:[(0,s.jsx)("div",{className:"bg-white shadow rounded-lg overflow-hidden",style:{height:"600px"},children:(0,s.jsxs)(n,{center:[E,R],zoom:13,style:{height:"100%",width:"100%"},children:[(0,s.jsx)(o,{attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),(0,s.jsx)(d,{position:[E,R],children:(0,s.jsx)(c,{children:(0,s.jsxs)("div",{className:"p-2",children:[(0,s.jsxs)("h3",{className:"font-bold",children:["START: ",e.name]}),(0,s.jsx)("p",{className:"text-xs",children:e.address})]})})}),D.length>0?D.map((e,t)=>(0,s.jsx)(u,{positions:e.coordinates,color:"#2563eb",weight:4,opacity:.7},t)):(0,s.jsx)(u,{positions:U,color:"#3b82f6",weight:3,opacity:.5}),L&&(0,s.jsx)("div",{className:"absolute top-4 right-4 bg-white px-4 py-2 rounded shadow-lg z-[1000]",children:(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Loading driving routes..."})}),p.map((e,t)=>{var a,r;let i=parseFloat(e.deliveryLatitude),l=parseFloat(e.deliveryLongitude),n=w.divIcon({html:'<div style="background-color: #3b82f6; color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3);">'.concat(t+1,"</div>"),className:"",iconSize:[30,30],iconAnchor:[15,15]});return(0,s.jsx)(d,{position:[i,l],icon:n,children:(0,s.jsx)(c,{children:(0,s.jsxs)("div",{className:"p-2",children:[(0,s.jsxs)("h3",{className:"font-bold",children:["Stop #",t+1]}),(0,s.jsx)("p",{className:"text-sm",children:e.trackingNumber}),(0,s.jsx)("p",{className:"text-sm",children:e.recipientName}),(0,s.jsx)("p",{className:"text-xs text-gray-600",children:e.deliveryAddress}),(0,s.jsxs)("p",{className:"text-xs text-blue-600 mt-1",children:[null==(a=e.distance)?void 0:a.toFixed(2)," km from previous (",h(e.drivingTime),")"]}),(0,s.jsxs)("p",{className:"text-xs text-purple-600",children:["Est. arrival: ",null==(r=e.estimatedArrival)?void 0:r.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})]})]})})},e.id)})]})}),(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:[(0,s.jsx)("div",{className:"px-6 py-4 border-b",children:(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Delivery Sequence"})}),(0,s.jsx)("div",{className:"overflow-y-auto",style:{maxHeight:"536px"},children:p.map((e,t)=>{var a,r;return(0,s.jsx)("div",{className:"px-6 py-4 border-b hover:bg-gray-50 transition",children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)("div",{className:"bg-blue-600 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0",children:t+1}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("div",{className:"font-medium text-gray-900",children:e.recipientName}),(0,s.jsx)("div",{className:"text-sm text-gray-600 truncate",children:e.deliveryAddress}),(0,s.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:e.trackingNumber}),e.specialInstructions&&(0,s.jsxs)("div",{className:"text-xs text-blue-600 mt-1",children:["\uD83D\uDCDD ",e.specialInstructions]}),(0,s.jsxs)("div",{className:"flex gap-3 mt-2",children:[(0,s.jsxs)("div",{className:"text-xs bg-blue-50 text-blue-700 px-2 py-1 rounded",children:["\uD83D\uDE97 ",null==(a=e.distance)?void 0:a.toFixed(2)," km (",h(e.drivingTime),")"]}),(0,s.jsxs)("div",{className:"text-xs bg-purple-50 text-purple-700 px-2 py-1 rounded",children:["â± ",h(e.deliveryTime)," delivery"]})]}),(0,s.jsxs)("div",{className:"text-xs text-purple-600 mt-1",children:["Est. arrival: ",null==(r=e.estimatedArrival)?void 0:r.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})]})]})]})},e.id)})})]})]}),(0,s.jsx)("div",{className:"mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,s.jsxs)("p",{className:"text-blue-800 text-sm",children:[(0,s.jsx)("strong",{children:"Route Optimization:"})," This route is optimized using the nearest-neighbor algorithm. Starting from your hub, each delivery stop is chosen as the nearest unvisited package location.",D.length>0?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("br",{}),(0,s.jsx)("strong",{children:"Driving Routes:"})," Actual driving routes are fetched from OpenStreetMap Routing Machine (OSRM), showing real road paths instead of straight lines. Distances and times are calculated based on actual road networks."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("br",{}),(0,s.jsx)("strong",{children:"Note:"})," Routes are shown as straight lines. Actual driving distances and times assume an average urban speed of 35 km/h plus 4 minutes per delivery stop."]})]})})]})})}},4054:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{bindSnapshot:function(){return l},createAsyncLocalStorage:function(){return i},createSnapshot:function(){return n}});let a=Object.defineProperty(Error("Invariant: AsyncLocalStorage accessed in runtime where it is not available"),"__NEXT_ERROR_CODE",{value:"E504",enumerable:!1,configurable:!0});class s{disable(){throw a}getStore(){}run(){throw a}exit(){throw a}enterWith(){throw a}static bind(e){return e}}let r="undefined"!=typeof globalThis&&globalThis.AsyncLocalStorage;function i(){return r?new r:new s}function l(e){return r?r.bind(e):s.bind(e)}function n(){return r?r.snapshot():function(e,...t){return e(...t)}}},4437:(e,t,a)=>{"use strict";function s(e){let{reason:t,children:a}=e;return a}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return s}}),a(4553)},6278:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r}});let s=a(8140)._(a(1150));function r(e,t){var a;let r={};"function"==typeof e&&(r.loader=e);let i={...r,...t};return(0,s.default)({...i,modules:null==(a=i.loadableGenerated)?void 0:a.modules})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},6552:(e,t,a)=>{"use strict";function s(e){let{moduleIds:t}=e;return null}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadChunks",{enumerable:!0,get:function(){return s}}),a(5155),a(7650),a(8567),a(7278)},7185:(e,t,a)=>{Promise.resolve().then(a.bind(a,1753))},7621:(e,t,a)=>{"use strict";a.d(t,{ZQ:()=>l,bI:()=>n,ic:()=>d,ox:()=>o});var s=a(5125);let r=a(5704).env.NEXT_PUBLIC_API_URL||"http://localhost:8080/api/v1",i=s.A.create({baseURL:r,headers:{"Content-Type":"application/json"}});i.interceptors.request.use(e=>{let t=localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e});let l={login:(e,t)=>i.post("/auth/login",{email:e,password:t}),register:e=>i.post("/auth/register",e),getProfile:()=>i.get("/auth/profile")},n={getAll:()=>i.get("/hubs"),getMyHubs:()=>i.get("/hubs/my-hubs"),getById:e=>i.get("/hubs/".concat(e)),getMetrics:(e,t)=>i.get("/hubs/".concat(e,"/metrics"),{params:{days:t}}),create:e=>i.post("/hubs",e),update:(e,t)=>i.put("/hubs/".concat(e),t)},o={getAll:e=>i.get("/packages",{params:e}),getById:e=>i.get("/packages/".concat(e)),track:e=>i.get("/packages/tracking/".concat(e)),create:e=>i.post("/packages",e),update:(e,t)=>i.put("/packages/".concat(e),t),delete:e=>i.delete("/packages/".concat(e))},d={getDashboard:()=>i.get("/admin/dashboard"),getPendingApplications:(e,t)=>i.get("/admin/applications/pending",{params:{page:e,limit:t}}),getApplicationDetails:e=>i.get("/admin/applications/".concat(e)),reviewApplication:(e,t)=>i.post("/admin/applications/".concat(e,"/review"),t)}},7828:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"workAsyncStorageInstance",{enumerable:!0,get:function(){return s}});let s=(0,a(4054).createAsyncLocalStorage)()},7909:(e,t,a)=>{"use strict";a.d(t,{default:()=>r.a});var s=a(6278),r=a.n(s)},8567:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"workAsyncStorage",{enumerable:!0,get:function(){return s.workAsyncStorageInstance}});let s=a(7828)}},e=>{e.O(0,[125,441,255,358],()=>e(e.s=7185)),_N_E=e.O()}]);